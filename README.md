# Распределённый вычислитель арифметических выражений

## Описание проекта

Этот проект представляет собой распределённую систему вычисления арифметических выражений, в которой вычисления выполняются асинхронно и могут масштабироваться за счёт добавления новых вычислительных узлов.

Система состоит из двух основных компонентов:
1. **Оркестратор** — принимает выражения от пользователей, разбивает их на отдельные операции и распределяет задачи между вычислителями (агентами).
2. **Агент** — получает задачи от оркестратора, выполняет операции (сложение, вычитание, умножение, деление) и отправляет результат обратно.

## Архитектура

### 1. Оркестратор
Оркестратор управляет задачами вычислений, а также предоставляет API для взаимодействия с пользователем и агентами. Он:
- Принимает выражения и разбивает их на задачи.
- Хранит статус вычислений.
- Раздаёт задачи агентам и получает результаты.

### 2. Агент
Агент запрашивает задачи у оркестратора, выполняет их и возвращает результаты. Он работает многопоточно, создавая несколько вычислительных горутин (количество настраивается переменной среды `COMPUTING_POWER`).

## Структура проекта

Проект состоит из следующих директорий:

- **`cmd/orchestrator/`** — основной код запуска оркестратора.
- **`cmd/agent/`** — основной код запуска агента.
- **`internal/orchestrator/`** — внутренняя логика оркестратора (управление выражениями, задачами, вычислениями).
- **`internal/agent/`** — внутренняя логика агента (получение задач, вычисления, отправка результатов).
- **`pkg/`** — вспомогательные библиотеки и модули.
- **`Dockerfile`** и **`docker-compose.yml`** — файлы для контейнеризации и развертывания системы.

## Запуск проекта

1. Клонируй репозиторий:
    ```sh
    git clone https://github.com/MaxGolubev19/GoCalculator.git
    cd GoCalculator
    ```

2. Создай файл `.env` в корне проекта:
    ```
    PORT=8080
    COMPUTING_POWER=10
    TIME_ADDITION_MS=100
    TIME_SUBTRACTION_MS=200
    TIME_MULTIPLICATIONS_MS=300
    TIME_DIVISIONS_MS=400
    ```

3. Запусти систему с помощью Docker:
    ```sh
    docker-compose up --build
    ```

## Переменные окружения

| Переменная                | Описание                                  |
|---------------------------|-------------------------------------------|
| `PORT`                    | Порт, на котором запускается оркестратор  |
| `COMPUTING_POWER`         | Количество горутин для вычислений         |
| `TIME_ADDITION_MS`        | Время выполнения операции сложения (мс)   |
| `TIME_SUBTRACTION_MS`     | Время выполнения операции вычитания (мс)  |
| `TIME_MULTIPLICATIONS_MS` | Время выполнения операции умножения (мс)  |
| `TIME_DIVISIONS_MS`       | Время выполнения операции деления (мс)    |

## API

### 1. Добавление выражения
```sh
curl --location 'localhost/api/v1/calculate' \
--header 'Content-Type: application/json' \
--data '{
  "expression": "2+2*2"
}'
```
**Коды ответов:**
- `201 Created` — выражение принято для вычисления.
- `422 Unprocessable Entity` — некорректные данные.
- `500 Internal Server Error` — внутренняя ошибка сервера.

**Ответ:**
```json
{
    "id": 42
}
```

### 2. Получение списка выражений
```sh
curl --location 'localhost/api/v1/expressions'
```
**Коды ответов:**
- `200 OK` — успешно получен список выражений.
- `500 Internal Server Error` — внутренняя ошибка сервера.

**Ответ:**
```json
{
    "expressions": [
        {
            "id": 42,
            "status": "IN PROGRESS",
            "result": 0
        }
    ]
}
```

### 3. Получение выражения по ID
```sh
curl --location 'localhost/api/v1/expressions/идентификатор'
```
**Коды ответов:**
- `200 OK` — успешно получено выражение.
- `404 Not Found` — выражение не найдено.
- `500 Internal Server Error` — внутренняя ошибка сервера.

**Ответ:**
```json
{
    "expression": {
        "id": 42,
        "status": "DONE",
        "result": 6
    }
}
```

### 4. Получение задачи для вычисления
```sh
curl --location 'localhost/internal/task'
```
**Коды ответов:**
- `200 OK` — успешно получена задача.
- `404 Not Found` — нет доступных задач.
- `500 Internal Server Error` — внутренняя ошибка сервера.

**Ответ:**
```json
{
    "task": {
        "id": 1,
        "arg1": 2,
        "arg2": 2,
        "operation": "*",
        "operation_time": 500
    }
}
```

### 5. Отправка результата вычисления
```sh
curl --location --request POST 'localhost/internal/task' \
--header 'Content-Type: application/json' \
--data '{
  "id": 1,
  "result": 4
}'
```
**Коды ответов:**
- `200 OK` — успешно записан результат.
- `404 Not Found` — задача не найдена.
- `422 Unprocessable Entity` — некорректные данные.
- `500 Internal Server Error` — внутренняя ошибка сервера.

## Тестирование
Проект покрыт тестами, которые можно запустить командой:
```sh
go test ./...
```

## Дополнительная информация
Проект разработан с использованием `Go` и поддерживает запуск в контейнерах `Docker`. Оркестратор и агент взаимодействуют через HTTP API.

